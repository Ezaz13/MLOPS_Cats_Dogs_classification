<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Heart Disease Prediction System</title>
    <!-- Bootstrap 5 CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <style>
        body { background-color: #f4f7f6; font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; }
        .main-container { max-width: 900px; margin: 40px auto; background: #ffffff; padding: 40px; border-radius: 15px; box-shadow: 0 10px 25px rgba(0,0,0,0.05); }
        .header { text-align: center; margin-bottom: 40px; border-bottom: 2px solid #f0f0f0; padding-bottom: 20px; }
        .header h1 { color: #2c3e50; font-weight: 700; }
        .form-label { font-weight: 600; color: #34495e; }
        .btn-predict { background-color: #3498db; border: none; padding: 12px 30px; font-size: 1.1rem; transition: all 0.3s; }
        .btn-predict:hover { background-color: #2980b9; transform: translateY(-2px); }
        .result-card { display: none; margin-top: 30px; border-radius: 10px; overflow: hidden; animation: fadeIn 0.5s; }
        .result-header { padding: 15px; font-weight: bold; font-size: 1.2rem; text-align: center; color: white; }
        .result-body { padding: 20px; text-align: center; background: #f8f9fa; border: 1px solid #dee2e6; border-top: none; border-radius: 0 0 10px 10px; }
        .status-badge { position: absolute; top: 20px; right: 20px; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }
    </style>
</head>
<body>

<div class="container">
    <div class="main-container position-relative">
        <!-- System Status Indicator -->
        <span id="system-status" class="badge bg-secondary status-badge">Checking System...</span>

        <div class="header">
            <h1>Heart Disease Risk Assessment</h1>
            <p class="text-muted">Enter patient clinical data to generate a risk prediction.</p>
        </div>

        <form id="prediction-form">
            <div class="row g-4">
                <!-- Age -->
                <div class="col-md-4">
                    <label for="age" class="form-label">Age</label>
                    <input type="number" class="form-control" id="age" name="age" required min="1" max="120" value="55">
                </div>
                <!-- Sex -->
                <div class="col-md-4">
                    <label for="sex" class="form-label">Sex</label>
                    <select class="form-select" id="sex" name="sex" required>
                        <option value="1">Male</option>
                        <option value="0">Female</option>
                    </select>
                </div>
                <!-- CP -->
                <div class="col-md-4">
                    <label for="cp" class="form-label">Chest Pain Type</label>
                    <select class="form-select" id="cp" name="cp" required>
                        <option value="0">Typical Angina</option>
                        <option value="1">Atypical Angina</option>
                        <option value="2">Non-anginal Pain</option>
                        <option value="3">Asymptomatic</option>
                    </select>
                </div>
                <!-- Trestbps -->
                <div class="col-md-4">
                    <label for="trestbps" class="form-label">Resting BP (mm Hg)</label>
                    <input type="number" class="form-control" id="trestbps" name="trestbps" required value="130">
                </div>
                <!-- Chol -->
                <div class="col-md-4">
                    <label for="chol" class="form-label">Cholesterol (mg/dl)</label>
                    <input type="number" class="form-control" id="chol" name="chol" required value="250">
                </div>
                <!-- FBS -->
                <div class="col-md-4">
                    <label for="fbs" class="form-label">Fasting BS > 120 mg/dl</label>
                    <select class="form-select" id="fbs" name="fbs" required>
                        <option value="0">False</option>
                        <option value="1">True</option>
                    </select>
                </div>
                <!-- Restecg -->
                <div class="col-md-4">
                    <label for="restecg" class="form-label">Resting ECG</label>
                    <select class="form-select" id="restecg" name="restecg" required>
                        <option value="0">Normal</option>
                        <option value="1">ST-T Wave Abnormality</option>
                        <option value="2">Left Ventricular Hypertrophy</option>
                    </select>
                </div>
                <!-- Thalach -->
                <div class="col-md-4">
                    <label for="thalach" class="form-label">Max Heart Rate</label>
                    <input type="number" class="form-control" id="thalach" name="thalach" required value="150">
                </div>
                <!-- Exang -->
                <div class="col-md-4">
                    <label for="exang" class="form-label">Exercise Angina</label>
                    <select class="form-select" id="exang" name="exang" required>
                        <option value="0">No</option>
                        <option value="1">Yes</option>
                    </select>
                </div>
                <!-- Oldpeak -->
                <div class="col-md-4">
                    <label for="oldpeak" class="form-label">ST Depression</label>
                    <input type="number" step="0.1" class="form-control" id="oldpeak" name="oldpeak" required value="1.0">
                </div>
                <!-- Slope -->
                <div class="col-md-4">
                    <label for="slope" class="form-label">ST Slope</label>
                    <select class="form-select" id="slope" name="slope" required>
                        <option value="0">Upsloping</option>
                        <option value="1">Flat</option>
                        <option value="2">Downsloping</option>
                    </select>
                </div>
                <!-- CA -->
                <div class="col-md-4">
                    <label for="ca" class="form-label">Major Vessels (0-3)</label>
                    <input type="number" class="form-control" id="ca" name="ca" required min="0" max="3" value="0">
                </div>
                <!-- Thal -->
                <div class="col-md-12">
                    <label for="thal" class="form-label">Thalassemia</label>
                    <select class="form-select" id="thal" name="thal" required>
                        <option value="1">Normal</option>
                        <option value="2">Fixed Defect</option>
                        <option value="3">Reversable Defect</option>
                    </select>
                </div>
            </div>

            <div class="d-grid gap-2 mt-5">
                <button type="submit" class="btn btn-primary btn-predict text-white">Analyze Risk</button>
            </div>
        </form>

        <!-- Results Section -->
        <div id="result-card" class="result-card">
            <div id="result-header" class="result-header">Prediction Result</div>
            <div class="result-body">
                <h3 id="prediction-text" class="mb-3"></h3>
                <div class="progress mb-3" style="height: 25px;">
                    <div id="confidence-bar" class="progress-bar progress-bar-striped progress-bar-animated" role="progressbar" style="width: 0%"></div>
                </div>
                <p id="confidence-text" class="text-muted mb-0"></p>
            </div>
        </div>
    </div>
</div>

<script>
    // Check Health Status
    fetch('/health').then(res => res.json()).then(data => {
        const badge = document.getElementById('system-status');
        if(data.status === 'healthy') {
            badge.className = 'badge bg-success status-badge';
            badge.textContent = 'System Online';
        } else {
            badge.className = 'badge bg-danger status-badge';
            badge.textContent = 'System Issues';
        }
    }).catch(() => {
        const badge = document.getElementById('system-status');
        badge.className = 'badge bg-danger status-badge';
        badge.textContent = 'Offline';
    });

    // Handle Form Submit
    document.getElementById('prediction-form').addEventListener('submit', async (e) => {
        e.preventDefault();
        const formData = new FormData(e.target);
        const data = Object.fromEntries(formData.entries());
        
        // Convert numeric strings to numbers
        ['age', 'sex', 'cp', 'trestbps', 'chol', 'fbs', 'restecg', 'thalach', 'exang', 'slope', 'ca'].forEach(k => data[k] = parseInt(data[k]));
        data['oldpeak'] = parseFloat(data['oldpeak']);

        const res = await fetch('/predict', {
            method: 'POST',
            headers: {'Content-Type': 'application/json'},
            body: JSON.stringify(data)
        });
        
        const result = await res.json();
        const card = document.getElementById('result-card');
        const header = document.getElementById('result-header');
        const text = document.getElementById('prediction-text');
        const bar = document.getElementById('confidence-bar');
        const confText = document.getElementById('confidence-text');

        card.style.display = 'block';
        
        if(res.ok) {
            const pred = result[0].prediction;
            const conf = (result[0].confidence * 100).toFixed(1);
            
            if(pred === 1) {
                header.className = 'result-header bg-danger';
                header.textContent = 'High Risk Detected';
                text.textContent = 'Patient shows signs of heart disease.';
                bar.className = 'progress-bar bg-danger';
            } else {
                header.className = 'result-header bg-success';
                header.textContent = 'Low Risk Detected';
                text.textContent = 'Patient is likely healthy.';
                bar.className = 'progress-bar bg-success';
            }
            
            bar.style.width = conf + '%';
            bar.textContent = conf + '%';
            confText.textContent = `Model Confidence: ${conf}%`;
        } else {
            header.className = 'result-header bg-warning text-dark';
            header.textContent = 'Error';
            text.textContent = result.error || 'Unknown error';
            bar.style.width = '0%';
        }
    });
</script>
</body>
</html>